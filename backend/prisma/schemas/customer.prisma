model Customer {
  id              String   @id @default(uuid())
  shopId          String

  // Datos personales
  fullName        String
  email           String?
  phone           String?
  dni             String?
  address         String?

  // Cuenta corriente
  creditLimit     Float    @default(0) // Límite de crédito
  currentBalance  Float    @default(0) // Saldo actual (lo que debe)

  // Estado
  isActive        Boolean  @default(true)
  notes           String?

  // Fechas
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relaciones
  shop            Shop     @relation(fields: [shopId], references: [id])
  sales           Sale[]
  payments        CustomerPayment[]
  accountMovements CustomerAccountMovement[]

  @@unique([shopId, dni]) // DNI único por tienda
  @@index([shopId, isActive])
}

model CustomerPayment {
  id              String   @id @default(uuid())
  customerId      String
  shopId          String

  // Monto
  amount          Float
  paymentMethod   PaymentMethod @default(CASH)

  // Referencia
  referenceNumber String?  // Número de comprobante, transferencia, etc.
  notes           String?

  // Fechas
  paymentDate     DateTime @default(now())
  createdAt       DateTime @default(now())

  // Relaciones
  customer        Customer @relation(fields: [customerId], references: [id])
  movement        CustomerAccountMovement?

  @@index([customerId, paymentDate])
}

model CustomerAccountMovement {
  id              String   @id @default(uuid())
  customerId      String
  shopId          String

  // Tipo de movimiento
  type            AccountMovementType
  amount          Float

  // Saldo antes y después
  previousBalance Float
  newBalance      Float

  // Referencias
  saleId          String?  @unique
  paymentId       String?  @unique

  // Detalles
  description     String?

  // Fecha
  createdAt       DateTime @default(now())

  // Relaciones
  customer        Customer @relation(fields: [customerId], references: [id])
  sale            Sale?    @relation(fields: [saleId], references: [id])
  payment         CustomerPayment? @relation(fields: [paymentId], references: [id])

  @@index([customerId, createdAt])
  @@index([shopId, createdAt])
}

enum AccountMovementType {
  SALE      // Venta a crédito (aumenta deuda)
  PAYMENT   // Pago (reduce deuda)
  ADJUSTMENT // Ajuste manual
}

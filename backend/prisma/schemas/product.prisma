model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  barcode     String?
  createdAt   DateTime @default(now())
  taxCategory String?
  taxRate     Float?

  categoryId String? // <--- agregado
  category   Category? @relation(fields: [categoryId], references: [id])

  shopProducts ShopProduct[]
}

model ShopProduct {
  id               String           @id @default(uuid())
  shopId           String
  productId        String
  costPrice        Float
  salePrice        Float
  stock            Int?
  createdAt        DateTime         @default(now())
  createdBy        String?
  currency         String           @default("ARS")
  isActive         Boolean          @default(true)
  productHistories ProductHistory[]
  purchaseItems    PurchaseItem[]
  product          Product          @relation(fields: [productId], references: [id])
  shop             Shop             @relation(fields: [shopId], references: [id])
  saleReturnItems  SaleReturnItem[]
  purchaseReturnItems PurchaseReturnItem[]
  replacementItems ReplacementItem[]
  saleItems        SaleItem[]

  @@unique([shopId, productId])
}

model ProductHistory {
  id            String      @id @default(uuid())
  shopProductId String
  userId        String?
  purchaseId    String?
  changeType    String
  previousCost  Float?
  newCost       Float?
  previousStock Int?
  newStock      Int?
  note          String?
  createdAt     DateTime    @default(now())
  purchase      Purchase?   @relation(fields: [purchaseId], references: [id])
  shopProduct   ShopProduct @relation(fields: [shopProductId], references: [id])
}

model Sale {
  id              String        @id @default(uuid())
  shopId          String
  customerId      String?       // Cliente (opcional, puede ser venta al público)
  employeeId      String?       // Empleado que realizó la venta
  cashRegisterId  String?       // Caja donde se registró

  // Montos
  subtotal        Float         // Suma de items sin descuentos
  discountAmount  Float         @default(0) // Descuento total aplicado
  taxAmount       Float         @default(0) // IVA total
  totalAmount     Float         // Total final a pagar

  // Métodos de pago
  paymentMethod   PaymentMethod @default(CASH)
  paymentStatus   PaymentStatus @default(PAID)

  // Datos adicionales
  saleDate        DateTime      @default(now())
  notes           String?
  invoiceNumber   String?       // Número de factura (si aplica)
  invoiceType     InvoiceType?  // Tipo de comprobante fiscal

  // Estado
  status          SaleStatus    @default(COMPLETED)
  isActive        Boolean       @default(true)

  // Relaciones
  shop            Shop          @relation(fields: [shopId], references: [id])
  customer        Customer?     @relation(fields: [customerId], references: [id])
  employee        Employee?     @relation(fields: [employeeId], references: [id])
  items           SaleItem[]
  saleReturns     SaleReturn[]  @relation("SaleToReturn")
  accountMovement CustomerAccountMovement?
  cashMovement    CashMovement?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([shopId, saleDate])
  @@index([customerId, saleDate])
  @@index([status, paymentStatus])
}

model SaleItem {
  id            String      @id @default(uuid())
  saleId        String
  shopProductId String

  // Cantidades y precios
  quantity      Int
  unitPrice     Float       // Precio unitario al momento de la venta
  subtotal      Float       // quantity * unitPrice
  discount      Float       @default(0) // Descuento aplicado a este item
  taxRate       Float       @default(0) // % de IVA
  taxAmount     Float       @default(0) // IVA calculado
  total         Float       // Subtotal - discount + taxAmount

  // Relaciones
  sale          Sale        @relation(fields: [saleId], references: [id], onDelete: Cascade)
  shopProduct   ShopProduct @relation(fields: [shopProductId], references: [id])

  createdAt     DateTime    @default(now())
}

// Enums para ventas
enum PaymentMethod {
  CASH            // Efectivo
  DEBIT_CARD      // Tarjeta de débito
  CREDIT_CARD     // Tarjeta de crédito
  TRANSFER        // Transferencia bancaria
  QR              // Pago con QR (MercadoPago, etc)
  ACCOUNT         // Cuenta corriente (a crédito)
  MIXED           // Pago mixto (varios métodos)
}

enum PaymentStatus {
  PENDING         // Pendiente de pago
  PAID            // Pagado
  PARTIAL         // Pago parcial
  OVERDUE         // Vencido (cuenta corriente)
  CANCELLED       // Cancelado
}

enum SaleStatus {
  DRAFT           // Borrador (no finalizada)
  COMPLETED       // Completada
  CANCELLED       // Cancelada
  RETURNED        // Devuelta (total o parcial)
}

enum InvoiceType {
  TICKET          // Ticket no fiscal
  FACTURA_A       // Factura A (responsables inscriptos)
  FACTURA_B       // Factura B (consumidor final)
  FACTURA_C       // Factura C (monotributista)
  NOTA_CREDITO_A  // Nota de crédito A
  NOTA_CREDITO_B  // Nota de crédito B
  NOTA_CREDITO_C  // Nota de crédito C
}

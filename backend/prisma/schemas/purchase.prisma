model Purchase {
  id           String           @id @default(uuid())
  supplierId   String?
  shopId       String
  totalAmount  Float?
  purchaseDate DateTime         @default(now())
  notes        String?
  histories    ProductHistory[]
  shop         Shop             @relation(fields: [shopId], references: [id])
  supplier     Supplier?        @relation(fields: [supplierId], references: [id])
  items        PurchaseItem[]
  creditNoteApplications CreditNoteApplication[]
}

model PurchaseItem {
  id            String      @id @default(uuid())
  purchaseId    String
  shopProductId String
  quantity      Int
  unitCost      Float
  subtotal      Float
  includesTax   Boolean     @default(true)
  purchase      Purchase    @relation(fields: [purchaseId], references: [id])
  shopProduct   ShopProduct @relation(fields: [shopProductId], references: [id])
}

model PurchaseDeletionHistory {
  id           String   @id @default(uuid())
  purchaseId   String   // ID de la compra eliminada
  shopId       String
  shopName     String
  supplierId   String?
  supplierName String?
  totalAmount  Float?
  purchaseDate DateTime
  originalNotes String?

  // Datos de la eliminación
  deletedBy    String   // User ID
  deletedByEmail String
  deletedAt    DateTime @default(now())
  deletionReason String // Razón obligatoria de eliminación

  // JSON con los items de la compra
  itemsSnapshot String  @db.Text // Guardamos los items en formato JSON
}

